@echo off
setlocal enabledelayedexpansion

rem Prompt the user to enter the repository name and branch name
set /p repo_name=Enter the repository name (e.g. my-repo.git):
set /p branch_name=Enter the branch name (e.g. main):

rem Set the Maven command to run
set mvn_command=mvn dependency:list -DincludeScope=runtime -DoutputType=csv

rem Set the npm command to run
set npm_command=npm ls --depth=0 --prod --json

rem Set the output file names
set mvn_output_file=maven-dependencies.csv
set npm_output_file=npm-dependencies.csv

rem Clone the repository and checkout the specified branch
git clone --depth=1 https://github.com/username/%repo_name% /tmp/%repo_name%
cd /tmp/%repo_name%
git checkout %branch_name%

rem List the Maven dependencies and write to CSV
%mvn_command% > %mvn_output_file%

rem List the Angular dependencies and write to CSV
%npm_command% > %npm_output_file%
for /f "tokens=2,3,4,5 delims=\":{}," %%d in ('type %npm_output_file% ^| findstr /C:"\"name\":"') do (
    set "name=%%~d"
    set "version=%%~f"
    echo !name!,!version! >> %npm_output_file%.csv
)

rem Delete the temporary directory
cd ..
rmdir /s /q %repo_name%

echo Done!
